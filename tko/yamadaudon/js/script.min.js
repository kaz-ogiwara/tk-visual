function addCommas(e){return String(e).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")}function getPopupContent(e){return'<div class="name">'+e[0]+'</div><div class="address">'+e[1]+"</div>"}var kMap=L.map("map").setView([35.9250076,139.6256953],11),kMarkers=[],kShops=[];L.tileLayer("https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, Tiles: <a href="http://hot.openstreetmap.org/" target="_blank">Humanitarian OpenStreetMap Team</a>',maxZoom:16,minZoom:9}).addTo(kMap),$.ajaxSetup({cache:!1}),$.getJSON("data/data.json",function(e){kShops=e,$.each(e,function(e,s){s[0],s[1],s[2],s[3];kMarkers[e]=L.marker([s[2],s[3]],{icon:L.divIcon()}).addTo(kMap).bindPopup(getPopupContent(s))})}),$(function(){$(document).on("click","#fullscreen",function(e){$.when($("#cover").fadeIn("fast")).done(function(){$.when($("body").addClass("fullscreen"),kMap.invalidateSize()).done(function(){$("#cover").fadeOut("fast")})})}),$(document).on("click","#button-close",function(e){e.stopPropagation(),$.when($("#cover").fadeIn("fast")).done(function(){$.when($("body").removeClass("fullscreen"),kMap.invalidateSize()).done(function(){$("#cover").fadeOut("fast")})})}),$(document).on("keydown","#input-shops",function(e){if(38===e.keyCode||40===e.keyCode){if(e.preventDefault(),$("#shop-suggestions").find("div")){var s=$("#shop-suggestions").find("div.selected");s&&(s.removeClass("selected"),38===e.which?s.prev()[0]?s.prev().addClass("selected"):$("#shop-suggestions").find("div:last").addClass("selected"):40===e.which&&(s.next()[0]?s.next().addClass("selected"):$("#shop-suggestions").find("div:first").addClass("selected")))}}else if(13===e.keyCode){let e=$("#shop-suggestions").find(".selected").attr("index"),s=$("#shop-suggestions").find(".selected").text();$("#shop-suggestions").removeClass("show"),$("#input-shops").val(s),kMap.setView(new L.LatLng(kShops[e][2],kShops[e][3]),13),kMarkers[e].openPopup()}}),$(document).on("keyup focus","#input-shops",function(e){let s=$(this).val();if(kShops&&""!=$(this).val()){if(38!==e.keyCode&&40!==e.keyCode&&13!==e.keyCode){$("#shop-suggestions").addClass("show"),$("#shop-suggestions").empty();let e=0;$.each(kShops,function(o,t){let n=!1;if(0===t[0].indexOf(s)&&(n=!0),0===t[1].indexOf(s)&&(n=!0),n&&($("#shop-suggestions").append('<div index="'+o+'">'+t[0]+"</div>"),e++),e>=20)return!1}),0===e&&$("#shop-suggestions").removeClass("show"),$("#shop-suggestions").find("div:first").addClass("selected")}}else $("#shop-suggestions").removeClass("show")}),$(document).on("focusout","#input-shops",function(e){$("#shop-suggestions").removeClass("show")})});